
# Тестовое задание для кандидата на позицию Junior LLM/ML Developer

## Задание 

Представим, что мы строим чат-бот для магазина-доставки цветов, которая работает в нескольких городах РФ.
В файле data.csv вы найдете 120 сообщений клиентов из чат-бота по заказу доставки цветов.
Задача - определить в каком городе клиент хочет сделать доставку.

## Решение

Данное решение было разбито на 2 этапа:
1. Определение города, его сокращения или сленгового названия в тексте сообщения. Для этого использовалась модель для распознования именованных сущностей, в частности ner_rus_bert от DeepPavlov. Так как город не всегда был представлен правильным названием и модель не могла всегда определять локацию, необходимо было подготовить датасет, для ее обучения. Исходный датасет сообщений был размечен в Label Studio, после чего размеченный вариант из json файла был преобразован в текстовый формат, в виде, подходящим для этой модели.
После чего модель успешно обучилась на этих сообщениях и смогла верно определять нестандартные вариант локаций.

2. Определение правильного названия по сокращению или сленговому названию, которое вернула нам модель из первого этапа. Для этого был использован классификатор на основе метода опорных векторов, в частности SVC от scikit-learn. Для обучения классификатора были собраны ответы модели первого этапа и добавлены правильные ответы к ним.

При итоговом тестировании решения на предоставленном датасете точность составила 116/120 (~97%). Стоить отметить, что модель первого этапа справилась без ошибок, а эти 4 ошибки допустил классификатор.

## Код

Все решение представлено в файле main.py. Если вы хотите полностью повторить процесс обучения всех этапов и получения результата, то код вызова функций должен быть таким:
```
    if __name__ == '__main__':
        data = pd.read_csv('data123.csv', delimiter=';')
        messages = data['message'].tolist()
        answers = data['Answer'].tolist()
        ner_config = 'ner_rus_bert_new.json'
        training_ner(ner_config)
        predictions = get_predictions_ner(ner_config, messages)
        train_svc(predictions, answers)
        results = get_cities_svc(predictions)
        save_results(results, messages)

```
Если вы хотите просто протестировать решение на одном сообщении, код должен выглядеть так:
```
    if __name__ == '__main__':
        ner_config = 'ner_rus_bert_new.json'
        message = 'Привет, хочу заказать доставку цветов в новосиб, какая цена?'
        custom_input(ner_config, message)
```
(измените текст переменной message на свой)

### Фукнции
- ```load_marked_data(annot_data)``` - преобразование размеченных данных в нужный формат
- ```training_ner(config)``` - обучение NER модели
- ```get_predictions_ner(config, messages)``` - получение результата от NER модели
- ```train_svc(predicted, answers)``` - обучение классификатора
- ```get_cities_svc(messages)``` - получение результатов от классификатора 
- ```save_results(results, messages)``` - сохранение результатов в csv
- ```custom_input(config, message)``` - тестирование на введенном сообщении

## Файлы

Исходный датасет, в который были добавлены ответы, для последующего обучения - **data123.csv**, файл с результатами - **data.csv**, **ner_rus_bert_new.json** - измененный файл конфигурации модели от DeepPavlov, **project-3-at-2024-03-22-01-23-cf7912b3.json** - размеченные сообщения, **data.txt** - данные в формате, который принимает NER модель для обучения,  **datas.txt** - данные для обучения классификатора, **model1.pkl** и **vecorizer1.pkl** - артефакты классификатора.
